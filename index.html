<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì²­ê°œêµ¬ë¦¬ ì‚¬ì „ì ê²€ AIì•± v17.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;800;900&family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0A6B5C;
            --primary-light: #12B89A;
            --primary-glow: rgba(18, 184, 154, 0.15);
            --accent: #FF6B35;
            --accent-light: #FF8F5E;
            --bg: #F5F7FA;
            --bg-warm: #FAFBFC;
            --card: #FFFFFF;
            --text: #1A2332;
            --text-sub: #5A6B7F;
            --text-hint: #94A3B8;
            --border: #E8ECF1;
            --border-light: #F1F4F8;
            --danger: #E74C3C;
            --danger-bg: #FFF5F5;
            --warning: #F39C12;
            --warning-bg: #FFFBE6;
            --purple: #7C3AED;
            --purple-bg: #F5F0FF;
            --shadow-xs: 0 1px 3px rgba(0,0,0,0.04);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 40px rgba(0,0,0,0.1);
            --shadow-glow: 0 0 30px rgba(18, 184, 154, 0.15);
            --radius-sm: 10px;
            --radius-md: 14px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --container: 100%;
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .app {
            width: 100%;
            max-width: var(--container);
            min-height: 100vh;
            background: var(--bg-warm);
            position: relative;
            padding-bottom: 100px;
        }

        /* â”€â”€ HEADER â”€â”€ */
        .header {
            background: linear-gradient(160deg, #0A3D2F 0%, #0A6B5C 40%, #12B89A 100%);
            padding: 14px 14px 20px;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);
            border-radius: 50%;
        }
        .header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 14px;
            background: var(--bg-warm);
            border-radius: 14px 14px 0 0;
        }
        .header-inner { display: flex; align-items: center; gap: 14px; position: relative; z-index: 2; flex-wrap: wrap; }
        .header-logo {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            flex-shrink: 0;
            overflow: hidden;
        }
        .header-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .header-text { flex: 1; }
        .header-title { color: white; font-family: 'Outfit', sans-serif; font-size: 1.15rem; font-weight: 800; letter-spacing: -0.02em; text-shadow: 0 2px 8px rgba(0,0,0,0.15); white-space: nowrap; }
        .header-sub { display: flex; align-items: center; gap: 8px; margin-top: 2px; width: 100%; justify-content: flex-end; }
        .version-tag {
            font-size: 0.65rem;
            background: rgba(255,255,255,0.18);
            color: rgba(255,255,255,0.9);
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: 600;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.12);
            cursor: pointer;
            transition: var(--transition);
            margin-left: auto;
        }
        .version-tag.dev-active {
            background: var(--purple);
            border-color: rgba(255,255,255,0.3);
            box-shadow: 0 0 12px rgba(124, 58, 237, 0.5);
        }
        .free-tag {
            font-size: 0.65rem;
            background: var(--accent);
            color: white;
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: 700;
        }

        /* â”€â”€ STATUS BAR â”€â”€ */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 10px;
        }
        .status-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--card);
            padding: 8px 14px;
            border-radius: 30px;
            font-size: 0.78rem;
            font-weight: 600;
            color: var(--text-sub);
            box-shadow: var(--shadow-xs);
            border: 1px solid var(--border-light);
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary-light);
            animation: pulse-dot 2s infinite;
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        .status-dot.error { background: var(--danger); animation: none; }
        .btn-manual {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--card);
            border: 1px solid var(--border);
            padding: 8px 14px;
            border-radius: 30px;
            font-size: 0.78rem;
            font-weight: 700;
            color: var(--text-sub);
            cursor: pointer;
            transition: var(--transition);
        }
        .btn-manual:active { transform: scale(0.96); }

        /* â”€â”€ STEP INDICATOR â”€â”€ */
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            padding: 4px 10px 8px;
        }
        .step-node {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 0.75rem;
            font-weight: 800;
            background: var(--border-light);
            color: var(--text-hint);
            transition: var(--transition);
            flex-shrink: 0;
        }
        .step-node.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 0 4px var(--primary-glow);
        }
        .step-node.done {
            background: var(--primary-light);
            color: white;
        }
        .step-line {
            height: 2px;
            width: 40px;
            background: var(--border-light);
            transition: var(--transition);
        }
        .step-line.done { background: var(--primary-light); }

        /* â”€â”€ SECTION CARD â”€â”€ */
        .section {
            background: var(--card);
            margin: 0 6px 6px;
            border-radius: var(--radius-lg);
            padding: 14px 14px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }
        .section-title {
            font-size: 0.82rem;
            font-weight: 800;
            color: var(--text-sub);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.01em;
        }
        .section-title .num {
            background: var(--primary);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 7px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 900;
        }

        /* â”€â”€ INPUTS â”€â”€ */
        .input-group { margin-bottom: 10px; }
        .input-group:last-child { margin-bottom: 0; }
        .input-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-hint);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .input-field {
            width: 100%;
            padding: 10px 12px;
            font-size: 0.88rem;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg-warm);
            color: var(--text);
            font-family: 'Noto Sans KR', sans-serif;
            transition: var(--transition);
            outline: none;
        }
        .input-field:focus {
            border-color: var(--primary-light);
            background: white;
            box-shadow: 0 0 0 3px var(--primary-glow);
        }
        .input-field::placeholder { color: var(--text-hint); }
        select.input-field { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2394A3B8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; }
        textarea.input-field { resize: none; height: 90px; line-height: 1.6; }
        .row { display: flex; gap: 10px; }
        .row > * { flex: 1; }
        .site-row { display: flex; gap: 8px; }
        .site-row input { text-align: center; font-weight: 700; }

        /* â”€â”€ PHOTO CAPTURE â”€â”€ */
        .photo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .photo-capture {
            aspect-ratio: 3/4;
            border-radius: var(--radius-md);
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            overflow: hidden;
            transition: var(--transition);
        }
        .photo-capture:active { transform: scale(0.98); }
        .photo-capture.wide {
            background: linear-gradient(180deg, #EBF5FF 0%, #DBEAFE 100%);
            border: 2px dashed #93C5FD;
        }
        .photo-capture.close {
            background: linear-gradient(180deg, #ECFDF5 0%, #D1FAE5 100%);
            border: 2px dashed var(--primary-light);
        }
        .photo-capture .icon {
            font-size: 2rem;
            opacity: 0.6;
        }
        .photo-capture.wide .icon { color: #3B82F6; }
        .photo-capture.close .icon { color: var(--primary-light); }
        .photo-capture .label {
            font-size: 0.78rem;
            font-weight: 700;
            text-align: center;
            line-height: 1.3;
            padding: 0 8px;
        }
        .photo-capture.wide .label { color: #3B82F6; }
        .photo-capture.close .label { color: var(--primary); }
        .photo-capture .hint {
            font-size: 0.68rem;
            color: var(--text-hint);
        }
        .photo-preview {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
            z-index: 10;
            background: white;
            border-radius: var(--radius-md);
        }
        .photo-capture .retake-badge {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            z-index: 15;
            display: none;
            backdrop-filter: blur(4px);
        }
        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            z-index: 20;
            pointer-events: none;
        }
        .crosshair::before, .crosshair::after {
            content: '';
            position: absolute;
            background: rgba(231, 76, 60, 0.6);
        }
        .crosshair::before { width: 100%; height: 1.5px; top: 50%; }
        .crosshair::after { height: 100%; width: 1.5px; left: 50%; }

        /* â”€â”€ USER INPUT â”€â”€ */
        .user-input-box {
            position: relative;
        }
        .user-input-box input {
            padding-right: 40px;
        }
        .user-input-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-light);
            font-size: 1rem;
        }

        /* â”€â”€ AI RESULT â”€â”€ */
        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.02em;
        }
        .auto-fields {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 14px;
        }
        .auto-field-label {
            font-size: 0.68rem;
            font-weight: 700;
            color: var(--text-hint);
            margin-bottom: 4px;
        }

        /* â”€â”€ AGREEMENT â”€â”€ */
        .agreement-box {
            background: var(--warning-bg);
            border: 1px solid #FEEBC8;
            border-radius: var(--radius-sm);
            padding: 10px 12px;
            margin-top: 12px;
        }
        .agreement-title {
            font-size: 0.78rem;
            font-weight: 800;
            color: #C05621;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .agreement-text {
            font-size: 0.68rem;
            color: var(--text-sub);
            line-height: 1.5;
            margin-bottom: 8px;
        }
        .check-row {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .check-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
            cursor: pointer;
            flex-shrink: 0;
        }
        .check-row label {
            font-size: 0.82rem;
            font-weight: 700;
            color: var(--text);
            cursor: pointer;
        }

        /* â”€â”€ SAVE BUTTON â”€â”€ */
        .btn-save {
            width: 100%;
            padding: 12px;
            margin-top: 12px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.92rem;
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .btn-save.enabled {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 14px rgba(10, 107, 92, 0.3);
        }
        .btn-save.enabled:active { transform: translateY(2px); box-shadow: none; }
        .btn-save.disabled {
            background: var(--border);
            color: var(--text-hint);
            cursor: not-allowed;
        }

        /* â”€â”€ DEFECT LIST â”€â”€ */
        .list-section {
            padding: 0 6px;
            margin-top: 10px;
        }
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card);
            padding: 16px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-bottom: 12px;
        }
        .list-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .list-count-badge {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 900;
            font-family: 'Outfit', sans-serif;
        }
        .list-header-title {
            font-size: 0.95rem;
            font-weight: 800;
        }
        .list-apt-info {
            font-size: 0.78rem;
            color: var(--primary);
            font-weight: 600;
        }

        .defect-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-bottom: 12px;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .defect-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--bg);
            border-bottom: 1px solid var(--border-light);
        }
        .defect-card-tag {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .defect-room {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--text);
        }
        .defect-type-badge {
            font-size: 0.72rem;
            font-weight: 700;
            color: var(--danger);
            background: var(--danger-bg);
            padding: 3px 8px;
            border-radius: 5px;
        }
        .defect-card-actions {
            display: flex;
            gap: 6px;
        }
        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }
        .btn-icon.edit { background: #FEF3C7; color: #D97706; }
        .btn-icon.delete { background: #FEE2E2; color: #EF4444; }
        .btn-icon:active { transform: scale(0.9); }

        .defect-card-photos {
            display: flex;
            gap: 2px;
            background: var(--border-light);
        }
        .defect-card-photos img {
            flex: 1;
            aspect-ratio: 4/3;
            object-fit: cover;
            background: #f9f9f9;
        }
        .defect-card-body { padding: 14px 16px; }
        .defect-card-work {
            font-size: 0.78rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 6px;
        }
        .defect-card-detail {
            font-size: 0.85rem;
            color: var(--text-sub);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        /* â”€â”€ BOTTOM ACTIONS â”€â”€ */
        .bottom-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            padding: 0 6px;
            margin-top: 14px;
        }
        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 16px 8px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            transition: var(--transition);
            text-decoration: none;
        }
        .action-btn:active { transform: scale(0.96); }
        .action-btn .action-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: white;
        }
        .action-btn .action-text {
            font-size: 0.78rem;
            font-weight: 700;
        }
        .action-btn.pdf { background: #ECFDF5; }
        .action-btn.pdf .action-icon { background: linear-gradient(135deg, #059669, #10B981); }
        .action-btn.pdf .action-text { color: #059669; }
        .action-btn.reserve { background: var(--purple-bg); }
        .action-btn.reserve .action-icon { background: linear-gradient(135deg, #7C3AED, #A78BFA); }
        .action-btn.reserve .action-text { color: var(--purple); }
        .action-btn.consult { background: #FFF7ED; }
        .action-btn.consult .action-icon { background: linear-gradient(135deg, var(--accent), var(--accent-light)); }
        .action-btn.consult .action-text { color: var(--accent); }

        /* â”€â”€ FOOTER â”€â”€ */
        .footer {
            text-align: center;
            padding: 20px 10px;
            margin-top: 28px;
            border-top: 1px solid var(--border-light);
        }
        .footer-brand {
            font-size: 0.82rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 4px;
        }
        .footer-info {
            font-size: 0.7rem;
            color: var(--text-hint);
            line-height: 1.5;
        }

        /* â”€â”€ MODALS â”€â”€ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(6px);
            padding: 20px;
        }
        .modal-box {
            background: white;
            width: 100%;
            max-width: 400px;
            border-radius: var(--radius-xl);
            padding: 28px 24px;
            box-shadow: var(--shadow-lg);
            animation: modalPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-height: 85vh;
            overflow-y: auto;
        }
        @keyframes modalPop { from { transform: scale(0.92); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-header {
            font-size: 1.2rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 20px;
        }
        .modal-close-text {
            display: block;
            text-align: center;
            margin-top: 14px;
            background: none;
            border: none;
            color: var(--text-hint);
            font-size: 0.85rem;
            cursor: pointer;
            text-decoration: underline;
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* ìœ ë£Œ ëª¨ë‹¬ */
        .price-grid {
            display: grid;
            gap: 8px;
            margin-bottom: 16px;
        }
        .price-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: var(--bg);
            border-radius: var(--radius-sm);
        }
        .price-label { font-size: 0.88rem; font-weight: 700; color: var(--text-sub); }
        .price-value { font-size: 0.95rem; font-weight: 900; color: var(--purple); }
        .notice-box {
            background: var(--warning-bg);
            border: 1px solid #FEEBC8;
            border-radius: var(--radius-sm);
            padding: 14px;
            font-size: 0.8rem;
            color: var(--text-sub);
            line-height: 1.6;
            margin-bottom: 16px;
        }
        .notice-box b { color: #C05621; }
        .btn-primary-full {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--purple), #A78BFA);
            color: white;
            font-size: 0.95rem;
            font-weight: 800;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 14px rgba(124, 58, 237, 0.3);
            transition: var(--transition);
        }
        .btn-primary-full:active { transform: translateY(2px); box-shadow: none; }

        /* â”€â”€ CHATBOT â”€â”€ */
        .chat-fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            z-index: 998;
            box-shadow: 0 4px 20px rgba(10, 107, 92, 0.35);
            transition: var(--transition);
            border: none;
        }
        .chat-fab:hover { transform: scale(1.05); }
        .chat-fab:active { transform: scale(0.95); }

        .chat-window {
            position: fixed;
            bottom: 85px;
            right: 16px;
            width: 320px;
            height: 440px;
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            z-index: 999;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border);
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(16px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .chat-head {
            background: var(--primary);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 800;
            font-size: 0.9rem;
        }
        .chat-head-close { cursor: pointer; font-size: 1.1rem; opacity: 0.8; background: none; border: none; color: white; }
        .chat-body {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .bubble {
            max-width: 82%;
            padding: 10px 14px;
            border-radius: 14px;
            font-size: 0.85rem;
            line-height: 1.5;
            box-shadow: var(--shadow-xs);
        }
        .bubble.bot {
            background: white;
            align-self: flex-start;
            border-top-left-radius: 4px;
            border: 1px solid var(--border-light);
        }
        .bubble.user {
            background: var(--primary);
            color: white;
            align-self: flex-end;
            border-top-right-radius: 4px;
        }
        .chat-quick {
            padding: 12px;
            background: white;
            border-top: 1px solid var(--border-light);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        .quick-btn {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            font-family: 'Noto Sans KR', sans-serif;
        }
        .quick-btn:active { background: var(--primary); color: white; border-color: var(--primary); }

        /* â”€â”€ PRINT STYLES â”€â”€ */
        @media print {
            body { background: white; }
            .app { max-width: 100%; box-shadow: none; padding-bottom: 0; }
            .header, .status-bar, .step-indicator, .section, .bottom-actions, .footer, .chat-fab, .chat-window, .defect-card-actions { display: none !important; }
            .list-section { padding: 0; margin: 0; }
            .list-header { border: none; box-shadow: none; margin-bottom: 20px; border-bottom: 2px solid #333; border-radius: 0; }
            .defect-card { break-inside: avoid; box-shadow: none; border: 1px solid #ccc; margin-bottom: 16px; }
            .defect-card-photos img { flex: 1; object-fit: contain; }
            #print-title { display: block !important; text-align: center; font-size: 22px; font-weight: 900; margin: 20px 0; }
            #print-disclaimer { display: block !important; text-align: center; font-size: 10px; color: #888; margin-top: 20px; padding-top: 10px; border-top: 1px solid #ddd; }
        }

        /* â”€â”€ HIDDEN â”€â”€ */
        .hidden { display: none !important; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>
    <div class="app">

        <!-- PRINT ONLY -->
        <div id="print-title" style="display:none;"></div>

        <!-- HEADER -->
        <header class="header">
        <div class="header-inner">
    <div class="header-logo">
        <img src="data:image/jpeg;base64,..." alt="">
    </div>
    <div class="header-text">
        <div class="header-title">ì²­ê°œêµ¬ë¦¬ ì‚¬ì „ì ê²€ AI ì•±</div>
    </div>
    <div class="header-sub">
        <span class="free-tag">ë¬´ë£Œ</span>
        <span class="version-tag" id="versionTag">v17.4</span>
    </div>
</div>   
        </header>

        <!-- STATUS -->
        <div class="status-bar">
            <div class="status-chip">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusMsg">AI ë¶„ì„ ì—”ì§„ ëŒ€ê¸°</span>
            </div>
            <button class="btn-manual" onclick="App.openManual()">
                <i class="fa-solid fa-circle-question"></i> ë„ì›€ë§
            </button>
        </div>

        <!-- STEP INDICATOR -->
        <div class="step-indicator">
            <div class="step-node active" id="step1">1</div>
            <div class="step-line" id="line1"></div>
            <div class="step-node" id="step2">2</div>
            <div class="step-line" id="line2"></div>
            <div class="step-node" id="step3">3</div>
            <div class="step-line" id="line3"></div>
            <div class="step-node" id="step4">4</div>
        </div>

        <!-- SECTION 1: í˜„ì¥ ì •ë³´ -->
        <div class="section">
            <div class="section-title">
                <span class="num">1</span> í˜„ì¥ ì •ë³´
            </div>
            <div class="input-group">
                <div class="input-label"><i class="fa-solid fa-map-pin"></i> ì „ì²´ ì£¼ì†Œ</div>
                <input type="text" class="input-field" id="fullAddress" placeholder="ì„œìš¸ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 300">
            </div>
            <div class="row" style="margin-top:10px;">
                <div class="input-group">
                    <div class="input-label">ì•„íŒŒíŠ¸ëª…</div>
                    <input type="text" class="input-field" id="aptName" placeholder="ì•„íŒŒíŠ¸ëª…">
                </div>
                <div class="input-group" style="flex:0.5;">
                    <div class="input-label">ë™</div>
                    <input type="tel" class="input-field" id="aptDong" placeholder="000" style="text-align:center;font-weight:800;">
                </div>
                <div class="input-group" style="flex:0.5;">
                    <div class="input-label">í˜¸</div>
                    <input type="tel" class="input-field" id="aptHo" placeholder="0000" style="text-align:center;font-weight:800;">
                </div>
            </div>
            <div class="input-group" style="margin-top:10px;">
                <div class="input-label"><i class="fa-solid fa-location-dot"></i> ì ê²€ ìœ„ì¹˜</div>
                <select class="input-field" id="roomSelect">
                    <option value="">ìœ„ì¹˜ ì„ íƒ</option>
                    <option>ê±°ì‹¤</option><option>ì£¼ë°©</option>
                    <option>ì¹¨ì‹¤1</option><option>ì¹¨ì‹¤2</option><option>ì¹¨ì‹¤3</option>
                    <option>ì•ˆë°©</option><option>ìš•ì‹¤1</option><option>ìš•ì‹¤2</option>
                    <option>í˜„ê´€</option><option>ë°œì½”ë‹ˆ</option><option>ë‹¤ìš©ë„ì‹¤</option>
                </select>
            </div>
        </div>

        <!-- SECTION 2: ì‚¬ì§„ ì´¬ì˜ -->
        <div class="section">
            <div class="section-title">
                <span class="num">2</span> ì‚¬ì§„ ì´¬ì˜
            </div>
            <div class="photo-grid">
                <input type="file" id="inputWide" accept="image/*">
                <label class="photo-capture wide" for="inputWide">
                    <i class="fa-solid fa-image icon"></i>
                    <div class="label">ë©€ë¦¬ì„œ ì°ê¸°<br><span class="hint">ìœ„ì¹˜ íŒŒì•…ìš©</span></div>
                    <img class="photo-preview" id="previewWide">
                    <div class="retake-badge" id="retakeWide">ë‹¤ì‹œì°ê¸°</div>
                </label>

                <input type="file" id="inputClose" accept="image/*">
                <label class="photo-capture close" for="inputClose">
                    <i class="fa-solid fa-crosshairs icon"></i>
                    <div class="label">ê°€ê¹Œì´ ì°ê¸°<br><span class="hint">AI ë¶„ì„ ì‹œì‘</span></div>
                    <img class="photo-preview" id="previewClose">
                    <div class="crosshair"></div>
                    <div class="retake-badge" id="retakeClose">ë‹¤ì‹œì°ê¸°</div>
                </label>
            </div>
        </div>

        <!-- SECTION 3: í•˜ì ì…ë ¥ -->
        <div class="section">
            <div class="section-title">
                <span class="num">3</span> í•˜ì ì •ë³´
            </div>
            <div class="input-group">
                <div class="input-label"><i class="fa-solid fa-pen"></i> í•˜ì ë‚´ìš© (ì§ì ‘ ì…ë ¥)</div>
                <div class="user-input-box">
                    <input type="text" class="input-field" id="userDefectInput" placeholder="ì˜ˆ) ì°½í˜¸ ìš°ì¸¡ ë‚´ë¶€ì°½ì§ ìˆ˜ì§ìˆ˜í‰ë¶ˆëŸ‰">
                    <i class="fa-solid fa-wand-magic-sparkles user-input-icon"></i>
                </div>
            </div>
            <div class="auto-fields">
                <div class="input-group">
                    <div class="auto-field-label">ê³µì¢…</div>
                    <select class="input-field" id="workType" style="font-size:0.82rem;padding:10px;">
                        <option value="">ìë™</option>
                    </select>
                </div>
                <div class="input-group">
                    <div class="auto-field-label">ì„¸ë¶€</div>
                    <select class="input-field" id="subWorkType" style="font-size:0.82rem;padding:10px;">
                        <option value="">ìë™</option>
                    </select>
                </div>
                <div class="input-group">
                    <div class="auto-field-label">ìœ í˜•</div>
                    <input type="text" class="input-field" id="defectType" placeholder="ìë™" style="font-size:0.82rem;padding:10px;">
                </div>
            </div>
            <div class="input-group">
                <div class="input-label">
                    <span class="ai-badge"><i class="fa-solid fa-robot"></i> AI ë¶„ì„ ë¦¬í¬íŠ¸</span>
                    <span style="font-size:0.7rem;color:var(--text-hint);margin-left:4px;">êµ­í† ë¶€ ë°ì´í„° ì°¸ì¡°</span>
                </div>
                <textarea class="input-field" id="defectDetail" placeholder="ì‚¬ì§„ ì´¬ì˜ ì‹œ AIê°€ ìë™ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤."></textarea>
            </div>

            <div class="agreement-box">
                <div class="agreement-title"><i class="fa-solid fa-shield-halved"></i> í•„ìˆ˜ í™•ì¸</div>
                <div class="agreement-text">
                    1. <b>ë²•ì  íš¨ë ¥ ì—†ìŒ:</b> AI ì¶”ì •ì¹˜ì´ë©° ì „ë¬¸ê°€ ì‹¤ì‚¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br>
                    2. <b>ì±…ì„ ì œí•œ:</b> ë¶„ì„ ì˜¤ë¥˜ì— ëŒ€í•´ ê°œë°œì‚¬ëŠ” ë²•ì  ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>
                <div class="check-row">
                    <input type="checkbox" id="agreeCheck" onchange="App.toggleSave()">
                    <label for="agreeCheck">ìœ„ ë‚´ìš©ì„ í™•ì¸í•˜ì˜€ìœ¼ë©° ë™ì˜í•©ë‹ˆë‹¤.</label>
                </div>
            </div>

            <button class="btn-save disabled" id="btnSave" onclick="App.saveToList()" disabled>
                <i class="fa-solid fa-check-circle"></i> ë¦¬ìŠ¤íŠ¸ì— ì €ì¥
            </button>
        </div>

        <!-- SECTION 4: ì ê²€ ë¦¬ìŠ¤íŠ¸ -->
        <div class="list-section">
            <div class="list-header">
                <div class="list-header-left">
                    <div class="list-count-badge" id="listCount">0</div>
                    <div>
                        <div class="list-header-title">ì ê²€ ë¦¬ìŠ¤íŠ¸</div>
                        <div class="list-apt-info" id="listAptInfo">ì •ë³´ ì…ë ¥ ëŒ€ê¸°</div>
                    </div>
                </div>
            </div>
            <div id="listBox"></div>
        </div>

        <!-- BOTTOM ACTIONS -->
        <div class="bottom-actions">
            <button class="action-btn pdf" onclick="App.savePDF()">
                <div class="action-icon"><i class="fa-solid fa-file-pdf"></i></div>
                <span class="action-text">ì „ì²´ ì €ì¥</span>
            </button>
            <button class="action-btn reserve" onclick="App.openPaidModal()">
                <div class="action-icon"><i class="fa-solid fa-calendar-check"></i></div>
                <span class="action-text">ìœ ë£Œ ì˜ˆì•½</span>
            </button>
            <button class="action-btn consult" onclick="App.toggleChat()">
                <div class="action-icon"><i class="fa-solid fa-comments"></i></div>
                <span class="action-text">AI ìƒë‹´</span>
            </button>
        </div>

        <div id="print-disclaimer" style="display:none;">
            â€» ë³¸ ë¦¬í¬íŠ¸ëŠ” ì…ì£¼ì ì‚¬ì „ì ê²€ ë³´ì¡° ìë£Œì´ë©° ë²•ì  íš¨ë ¥ì´ ì—†ìŠµë‹ˆë‹¤. (ì œê³µ: ì²­ê°œêµ¬ë¦¬ìƒ¤ì‹œ)
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <div class="footer-brand">ì²­ê°œêµ¬ë¦¬ìƒ¤ì‹œ</div>
            <div class="footer-info">
                ëŒ€í‘œ: ì „ì˜ì›… | ì‚¬ì—…ì: 123-36-31426 | ğŸ“ 010-2322-0949<br>
                ë³¸ ì„œë¹„ìŠ¤ëŠ” ì°¸ê³ ìš© ë³´ì¡° ë„êµ¬ì´ë©° ë²•ì  ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                â“’ 2026 Cheong-gaeguri Corp.
            </div>
        </div>
    </div>

    <!-- â”€â”€ MODAL: ìœ ë£Œ ì„œë¹„ìŠ¤ â”€â”€ -->
    <div class="modal-overlay hidden" id="paidModal">
        <div class="modal-box">
            <div class="modal-header" style="color:var(--purple);">ğŸ¸ ìœ ë£Œ ì‚¬ì „ì ê²€ ì•ˆë‚´</div>
            <p style="font-size:0.85rem;color:var(--text-sub);margin-bottom:16px;line-height:1.6;">
                ì²­ê°œêµ¬ë¦¬ëŠ” ë¶ˆí•„ìš”í•œ ì ê²€ì„ ìƒëµí•˜ê³  <b>ì¤‘ëŒ€í•˜ìë¥¼ ì¤‘ì </b>ìœ¼ë¡œ ê²€ì‚¬í•©ë‹ˆë‹¤.<br>ìˆ˜ë„ê¶Œ ì´ì™¸ëŠ” ì¶”ê°€ìš”ê¸ˆì´ ë°œìƒí•©ë‹ˆë‹¤.
            </p>
<div class="price-grid">
<div class="price-row"><span class="price-label">29í‰ ì´í•˜</span><span class="price-value">130,000ì›</span></div>
    <div class="price-row"><span class="price-label">30í‰ ì´ìƒ</span><span class="price-value">150,000ì›</span></div>
    <div class="price-row"><span class="price-label">50í‰ ì´ìƒ</span><span class="price-value">200,000ì›</span></div>
</div>
            <div class="notice-box">
                <b>ğŸ“‹ ì˜ˆì•½ ë° í™˜ë¶ˆ ê·œì •</b><br>
                1. ì„ ì…ê¸ˆ í›„ <b>ì§í†µ(010-2322-0949)</b>ìœ¼ë¡œ ì…ê¸ˆìÂ·ì£¼ì†ŒÂ·ë°©ë¬¸ì¼/ì‹œê°„ì„ ë¬¸ì ë°œì†¡ â†’ í™•ì • í†µë³´<br>
                2. ë°©ë¬¸ <b>7ì¼ ì „ ì·¨ì†Œ ì‹œ 100% í™˜ë¶ˆ</b><br>
                3. ê·¸ ì™¸ ê¸°ê°„ì€ í™˜ë¶ˆ ë¶ˆê°€<br>
                4. ì˜ˆì•½ì„œ ì‘ì„± ì‹œ ìœ„ ë‚´ìš©ì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼
            </div>
            <button class="btn-primary-full" onclick="App.goToForm()">
                <i class="fa-solid fa-pen-to-square"></i> ì˜ˆì•½ ì‹ ì²­ì„œ ì‘ì„±í•˜ê¸°
            </button>
            <button class="modal-close-text" onclick="App.closePaidModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- â”€â”€ MODAL: ë§¤ë‰´ì–¼ â”€â”€ -->
    <div class="modal-overlay hidden" id="manualModal">
        <div class="modal-box">
            <div class="modal-header">ğŸ¸ ì•± ì‚¬ìš©ë²•</div>
            <div style="font-size:0.88rem;color:var(--text-sub);line-height:1.8;text-align:left;">
                <b>â‘  í˜„ì¥ ì •ë³´</b> â€” ì£¼ì†Œ, ì•„íŒŒíŠ¸ëª…, ë™/í˜¸, ìœ„ì¹˜ ì…ë ¥<br>
                <b>â‘¡ ì‚¬ì§„ ì´¬ì˜</b> â€” ë©€ë¦¬ì„œ 1ì¥ + ê°€ê¹Œì´ 1ì¥<br>
                <b>â‘¢ í•˜ì ë‚´ìš©</b> â€” ì§ì ‘ ì…ë ¥í•˜ë©´ AIê°€ ë” ì •í™•í•˜ê²Œ ë¶„ì„<br>
                <b>â‘£ AI ìë™ ë¶„ì„</b> â€” ê³µì¢…, ì„¸ë¶€, ìœ í˜•, ë¦¬í¬íŠ¸ ìë™ ìƒì„±<br>
                <b>â‘¤ ë™ì˜ ì²´í¬</b> â†’ <b>ë¦¬ìŠ¤íŠ¸ ì €ì¥</b> ë°˜ë³µ<br>
                <b>â‘¥ ì „ì²´ ì €ì¥</b> â†’ PDFë¡œ ì €ì¥ ê°€ëŠ¥<br>
                <b>â‘¦ ì •ë°€ ì§„ë‹¨</b> â†’ ìœ ë£Œ ì‹ ì²­
            </div>
            <div class="check-row" style="margin-top:16px;padding:12px;background:var(--bg);border-radius:var(--radius-sm);">
                <input type="checkbox" id="manualCheck" onchange="App.closeManual()">
                <label for="manualCheck">ë„¤, ëª¨ë‘ í™•ì¸í–ˆìŠµë‹ˆë‹¤.</label>
            </div>
        </div>
    </div>

    <!-- â”€â”€ CHATBOT â”€â”€ -->
    <button class="chat-fab" onclick="App.toggleChat()">
        <i class="fa-solid fa-comment-dots"></i>
    </button>

    <div class="chat-window" id="chatWindow">
        <div class="chat-head">
            <span>ğŸ¸ ì²­ê°œêµ¬ë¦¬ ìƒë‹´</span>
            <button class="chat-head-close" onclick="App.toggleChat()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="bubble bot">ì•ˆë…•í•˜ì„¸ìš”! ì²­ê°œêµ¬ë¦¬ ìƒ¤ì‹œì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
        </div>
        <div class="chat-quick">
            <button class="quick-btn" onclick="App.askBot('cost')">ğŸ’° ë¹„ìš© ì•ˆë‚´</button>
            <button class="quick-btn" onclick="App.askBot('reason')">ğŸ“‰ ì‹¼ ì´ìœ ?</button>
            <button class="quick-btn" onclick="App.askBot('defect')">ğŸ› ï¸ ì¤‘ëŒ€í•˜ìë€?</button>
            <button class="quick-btn" onclick="App.askBot('booking')">ğŸ“… ì˜ˆì•½ ë°©ë²•</button>
        </div>
    </div>

    <script type="importmap">
        { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
    </script>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        const part1 = "AIzaSyBoHZXi7YdDmH";
        const part2 = "V6GMEw49MYi74LILPKeCI";
        const API_KEY = part1 + part2;
        const FORM_URL = "https://forms.gle/iF9t9gXCHkuMQj8W6";
        const DAILY_LIMIT = 100;

        let defectList = [];
        let wideFile = null;
        let closeFile = null;
        let devClicks = 0;
        let devTimer;

        // â”€â”€ INIT â”€â”€
        window.addEventListener('DOMContentLoaded', () => {
            const isDev = localStorage.getItem('is_developer') === 'true';
            if (isDev) document.getElementById('versionBadge').classList.add('dev-active');

            const workSel = document.getElementById('workType');
            ['íƒ€ì¼ê³µì‚¬','ë„ë°°ê³µì‚¬','ë§ˆë£¨ê³µì‚¬','ì°½í˜¸ê³µì‚¬','ê°€êµ¬ê³µì‚¬','ê¸°íƒ€ê³µì‚¬'].forEach(t => {
                const o = document.createElement('option');
                o.value = t; o.textContent = t;
                workSel.appendChild(o);
            });

            document.getElementById('inputWide').addEventListener('change', e => handlePhoto(e, 'wide'));
            document.getElementById('inputClose').addEventListener('change', e => handlePhoto(e, 'close'));

            updateSteps(1);
        });

        // â”€â”€ STEP INDICATOR â”€â”€
        function updateSteps(current) {
            for (let i = 1; i <= 4; i++) {
                const node = document.getElementById(`step${i}`);
                const line = document.getElementById(`line${i}`);
                node.classList.remove('active', 'done');
                if (line) line.classList.remove('done');
                if (i < current) { node.classList.add('done'); node.innerHTML = '<i class="fa-solid fa-check" style="font-size:0.7rem;"></i>'; if (line) line.classList.add('done'); }
                else if (i === current) { node.classList.add('active'); node.textContent = i; }
                else { node.textContent = i; }
            }
        }

        // â”€â”€ STATUS â”€â”€
        function setStatus(msg, error = false) {
            document.getElementById('statusMsg').textContent = msg;
            const dot = document.getElementById('statusDot');
            dot.classList.toggle('error', error);
        }

        // â”€â”€ DEV MODE â”€â”€
        window.App = {};
        App.checkDevMode = () => {
            clearTimeout(devTimer);
            devClicks++;
            if (devClicks === 5) {
                const isDev = localStorage.getItem('is_developer') === 'true';
                localStorage.setItem('is_developer', !isDev);
                const badge = document.getElementById('versionBadge');
                if (!isDev) { alert("ğŸ¸ ê°œë°œì ëª¨ë“œ í™œì„±í™”!"); badge.classList.add('dev-active'); }
                else { alert("ê°œë°œì ëª¨ë“œ í•´ì œ."); badge.classList.remove('dev-active'); }
                devClicks = 0;
            }
            devTimer = setTimeout(() => devClicks = 0, 1000);
        };

        // â”€â”€ DAILY LIMIT â”€â”€
        function checkLimit() {
            if (localStorage.getItem('is_developer') === 'true') return true;
            const today = new Date().toDateString();
            let data = JSON.parse(localStorage.getItem('frog_usage') || '{}');
            if (data.date !== today) data = { date: today, count: 0 };
            if (data.count >= DAILY_LIMIT) { alert(`âš ï¸ ì¼ì¼ ë¬´ë£Œ í•œë„(${DAILY_LIMIT}íšŒ) ì´ˆê³¼`); return false; }
            data.count++;
            localStorage.setItem('frog_usage', JSON.stringify(data));
            return true;
        }

        // â”€â”€ PHOTO HANDLING â”€â”€
        function handlePhoto(e, type) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                if (type === 'wide') {
                    wideFile = file;
                    const p = document.getElementById('previewWide');
                    p.src = ev.target.result; p.style.display = 'block';
                    document.getElementById('retakeWide').style.display = 'block';
                    setStatus("ê°€ê¹Œì´ ì°ê¸°ë¥¼ ì´¬ì˜í•˜ì„¸ìš”");
                    updateSteps(2);
                } else {
                    if (!checkLimit()) { document.getElementById('inputClose').value = ''; return; }
                    closeFile = file;
                    const p = document.getElementById('previewClose');
                    p.src = ev.target.result; p.style.display = 'block';
                    document.getElementById('retakeClose').style.display = 'block';
                    updateSteps(3);
                    runAI();
                }
            };
            reader.readAsDataURL(file);
        }

        async function toGenPart(file) {
            return new Promise(r => {
                const reader = new FileReader();
                reader.onloadend = () => r({ inlineData: { data: reader.result.split(',')[1], mimeType: file.type } });
                reader.readAsDataURL(file);
            });
        }

        // â”€â”€ AI ANALYSIS â”€â”€
        async function runAI() {
            const detail = document.getElementById('defectDetail');
            const userInput = document.getElementById('userDefectInput').value;
            detail.value = "ğŸ” AIê°€ ì •ë°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";
            setStatus("AI ë“€ì–¼ ì •ë°€ ë¶„ì„ ì¤‘...");

            try {
                const genAI = new GoogleGenerativeAI(API_KEY);
                const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash" });

                const prompt = `
                    ì…ì£¼ì ì‚¬ì „ì ê²€ AIì…ë‹ˆë‹¤.
                    ì‚¬ì§„ 1(Wide): ê³µì¢…(Work Type) íŒŒì•….
                    ì‚¬ì§„ 2(Close): í•˜ì ìœ í˜•(Type) ë° ìƒì„¸ ë‚´ìš©(Detail) íŒŒì•….
                    
                    **[ì‚¬ìš©ì ì¶”ê°€ ì…ë ¥ ì •ë³´]: "${userInput}"**
                    (ì´ ì •ë³´ê°€ ìˆë‹¤ë©´, ì´ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ë°˜ì˜í•˜ì—¬ ë¶„ì„ ê²°ê³¼ë¥¼ ìƒì„±í•˜ì„¸ìš”.)

                    [ì¤‘ìš” íŒë‹¨ ê¸°ì¤€]
                    - í•˜ìë¼ê³  íŒë‹¨ë˜ë©´: í˜„ìƒê³¼ ì‚¬ë¡€ë§¤ì¹­ì„ ìƒì„¸íˆ ê¸°ìˆ í•˜ì„¸ìš”.
                    - í•˜ìê°€ ì•„ë‹ˆë¼ê³  íŒë‹¨ë˜ë©´: "type"ì— "í—ˆìš©ë²”ìœ„"ë¡œ ê¸°ì¬í•˜ê³ , "detail"ì— ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”:
                      1. í˜„ìƒ: [ì‚¬ì§„ì—ì„œ ë³´ì´ëŠ” ìƒíƒœ ê¸°ìˆ ]
                      2. âœ… í—ˆìš©ë²”ìœ„ ì•ˆë‚´: [í•´ë‹¹ ê³µì¢…ì˜ êµ­í† ë¶€ í•˜ìíŒì • ê¸°ì¤€ìƒ í—ˆìš© ë²”ìœ„ë¥¼ ê°„ë‹¨íˆ ì„¤ëª…. ì˜ˆ) "íƒ€ì¼ ì¤„ëˆˆ í­ ì°¨ì´ 2mm ì´ë‚´ëŠ” í—ˆìš©ë²”ìœ„", "ë„ë°° ì´ìŒë¶€ 1mm ì´ë‚´ ë²Œì–´ì§ì€ ì‹œê³µ í—ˆìš© ì˜¤ì°¨" ë“±]
                      3. ğŸ’¡ ì°¸ê³ : í—ˆìš©ë²”ìœ„ ë‚´ì´ë¯€ë¡œ í•˜ì ì ‘ìˆ˜ ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.

                    [ì¶œë ¥ í˜•ì‹ JSON]
                    {
                        "work": "ê³µì¢…ëª…(ì˜ˆ: ì°½í˜¸ê³µì‚¬)",
                        "sub": "ì„¸ë¶€ê³µì¢…ëª…(ì˜ˆ: PLì°½í˜¸)",
                        "type": "í•˜ììœ í˜•(ì˜ˆ: íŒŒì†/ì°í˜/ì˜¤ì—¼/ìˆ˜ì§ìˆ˜í‰ë¶ˆëŸ‰) ë˜ëŠ” í—ˆìš©ë²”ìœ„",
                        "detail": "1. í˜„ìƒ: [ë³´ì´ëŠ” ëŒ€ë¡œ ê¸°ìˆ  + ì‚¬ìš©ì ì…ë ¥ ë‚´ìš© ë°˜ì˜]\\n2. ğŸ’¡ì‚¬ë¡€ë§¤ì¹­: [êµ­í† ë¶€ í•˜ì íŒì • ê¸°ì¤€ ì°¸ê³  ì„¤ëª…] ë˜ëŠ” âœ…í—ˆìš©ë²”ìœ„ ì•ˆë‚´"
                    }
                `;

                const parts = [prompt];
                if (wideFile) parts.push(await toGenPart(wideFile));
                if (closeFile) parts.push(await toGenPart(closeFile));

                const result = await model.generateContent(parts);
                const text = result.response.text();

                let data = {};
                try {
                    const clean = text.replace(/```json/g, '').replace(/```/g, '').trim();
                    const match = clean.match(/\{[\s\S]*\}/);
                    if (match) data = JSON.parse(match[0]);
                    else throw new Error('Parse fail');
                } catch { data = { detail: 'í…ìŠ¤íŠ¸ ë³€í™˜ ì‹¤íŒ¨. ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', work: 'ê¸°íƒ€', sub: '', type: 'í™•ì¸í•„ìš”' }; }

                document.getElementById('workType').value = data.work || '';
                const subSel = document.getElementById('subWorkType');
                subSel.innerHTML = `<option value="${data.sub || ''}">${data.sub || 'ìë™'}</option>`;
                document.getElementById('defectType').value = data.type || '';
                detail.value = (data.detail || '') + '\n\n(â€» AI ë¶„ì„ ê²°ê³¼ëŠ” ë‹¨ìˆœ ì°¸ê³ ìš©ì…ë‹ˆë‹¤.)';
                setStatus("ë¶„ì„ ì™„ë£Œ! í™•ì¸ í›„ ë™ì˜í•´ì£¼ì„¸ìš”.");
            } catch (err) {
                console.error('AI Error:', err);
                setStatus("ë¶„ì„ ì‹¤íŒ¨", true);
                detail.value = "ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
        }

        // â”€â”€ SAVE TOGGLE â”€â”€
        App.toggleSave = () => {
            const ok = document.getElementById('agreeCheck').checked;
            const btn = document.getElementById('btnSave');
            btn.disabled = !ok;
            btn.className = ok ? 'btn-save enabled' : 'btn-save disabled';
        };

        // â”€â”€ SAVE TO LIST â”€â”€
        App.saveToList = () => {
            if (!document.getElementById('agreeCheck').checked) return;

            const closeSrc = document.getElementById('previewClose').src;
            if (!closeFile && (!closeSrc || !closeSrc.startsWith('data:'))) {
                alert('ì‚¬ì§„ ì´¬ì˜(ê°€ê¹Œì´ ì°ê¸°)ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            const fullAddr = document.getElementById('fullAddress').value;
            const aptName = document.getElementById('aptName').value || (fullAddr ? 'ì£¼ì†Œì°¸ì¡°' : 'OOì•„íŒŒíŠ¸');
            const dong = document.getElementById('aptDong').value;
            const ho = document.getElementById('aptHo').value;
            const aptInfo = `${fullAddr} (${aptName} ${dong}ë™ ${ho}í˜¸)`;

            document.getElementById('listAptInfo').textContent = aptInfo;
            document.getElementById('print-title').textContent = aptInfo + ' ì‚¬ì „ì ê²€ ë¦¬í¬íŠ¸';

            const id = Date.now();
            const wideSrc = document.getElementById('previewWide').src;
            const item = {
                id,
                room: document.getElementById('roomSelect').value || 'ìœ„ì¹˜ë¯¸ì§€ì •',
                work: document.getElementById('workType').value,
                sub: document.getElementById('subWorkType').value,
                type: document.getElementById('defectType').value,
                detail: document.getElementById('defectDetail').value,
                wideImg: (wideSrc && wideSrc.startsWith('data:')) ? wideSrc : null,
                closeImg: closeSrc
            };
            defectList.push(item);

            const html = `
                <div class="defect-card" id="item-${id}">
                    <div class="defect-card-header">
                        <div class="defect-card-tag">
                            <span class="defect-room">${item.room}</span>
                            <span class="defect-type-badge">${item.type}</span>
                        </div>
                        <div class="defect-card-actions">
                            <button class="btn-icon edit" onclick="App.editItem(${id})"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn-icon delete" onclick="App.deleteItem(${id})"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                    </div>
                    <div class="defect-card-photos">
                        ${item.wideImg ? `<img src="${item.wideImg}">` : ''}
                        <img src="${item.closeImg}" style="${!item.wideImg ? 'width:100%' : ''}">
                    </div>
                    <div class="defect-card-body">
                        <div class="defect-card-work">${item.work} â†’ ${item.sub}</div>
                        <div class="defect-card-detail">${item.detail}</div>
                    </div>
                </div>
            `;

            document.getElementById('listBox').insertAdjacentHTML('beforeend', html);
            document.getElementById('listCount').textContent = defectList.length;

            // Reset
            ['inputWide', 'inputClose'].forEach(id => document.getElementById(id).value = '');
            wideFile = null; closeFile = null;
            ['previewWide', 'previewClose'].forEach(id => { document.getElementById(id).style.display = 'none'; });
            ['retakeWide', 'retakeClose'].forEach(id => { document.getElementById(id).style.display = 'none'; });
            document.getElementById('userDefectInput').value = '';
            document.getElementById('defectDetail').value = '';
            document.getElementById('agreeCheck').checked = false;
            App.toggleSave();
            updateSteps(4);
            setStatus("ì €ì¥ ì™„ë£Œ! ë‹¤ìŒ í•­ëª©ì„ ì´¬ì˜í•˜ì„¸ìš”.");
            document.querySelector('.list-header').scrollIntoView({ behavior: 'smooth' });
            setTimeout(() => updateSteps(1), 2000);
        };

        // â”€â”€ EDIT / DELETE â”€â”€
        App.editItem = (id) => {
            const idx = defectList.findIndex(i => i.id === id);
            if (idx === -1) return;
            const item = defectList[idx];

            if (!confirm('ìˆ˜ì • ëª¨ë“œë¡œ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            document.getElementById('roomSelect').value = item.room;
            document.getElementById('workType').value = item.work;
            document.getElementById('defectDetail').value = item.detail;
            if (item.wideImg) { const p = document.getElementById('previewWide'); p.src = item.wideImg; p.style.display = 'block'; document.getElementById('retakeWide').style.display = 'block'; }
            const p = document.getElementById('previewClose'); p.src = item.closeImg; p.style.display = 'block'; document.getElementById('retakeClose').style.display = 'block';

            document.getElementById(`item-${id}`).remove();
            defectList.splice(idx, 1);
            document.getElementById('listCount').textContent = defectList.length;
            window.scrollTo(0, 0);
        };

        App.deleteItem = (id) => {
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            document.getElementById(`item-${id}`).remove();
            defectList = defectList.filter(i => i.id !== id);
            document.getElementById('listCount').textContent = defectList.length;
        };

        // â”€â”€ PDF â”€â”€
        App.savePDF = () => {
            if (!defectList.length) { alert('ì €ì¥í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
            window.print();
        };

        // â”€â”€ MODALS â”€â”€
        App.openPaidModal = () => document.getElementById('paidModal').classList.remove('hidden');
        App.closePaidModal = () => document.getElementById('paidModal').classList.add('hidden');
        App.goToForm = () => window.open(FORM_URL, '_blank');
        App.openManual = () => { document.getElementById('manualCheck').checked = false; document.getElementById('manualModal').classList.remove('hidden'); };
        App.closeManual = () => { if (document.getElementById('manualCheck').checked) document.getElementById('manualModal').classList.add('hidden'); };

        // â”€â”€ CHATBOT â”€â”€
        App.toggleChat = () => {
            const w = document.getElementById('chatWindow');
            w.style.display = w.style.display === 'flex' ? 'none' : 'flex';
        };

        const botAnswers = {
            cost: { q: 'ë¹„ìš©ì´ ê¶ê¸ˆí•´ìš”.', a: 'ğŸ’° <b>ì ê²€ ë¹„ìš© ì•ˆë‚´</b><br>29í‰ ì´í•˜: 13ë§Œì›<br>30í‰ ì´ìƒ: 15ë§Œì›<br>50í‰ ì´ìƒ: 20ë§Œì›<br><br>â€» ìˆ˜ë„ê¶Œ ì™¸ ì§€ì—­ì€ ì¶”ê°€ ì¶œì¥ë¹„ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' },
            reason: { q: 'ì ê²€ ë¹„ìš©ì´ ì™œ ì´ë ‡ê²Œ ì‹¼ê°€ìš”?', a: 'ğŸ’¡ <b>ì €ë ´í•œ ì´ìœ </b><br>1. AI ë„ì…ìœ¼ë¡œ ì‹œê°„/ë¹„ìš© ì ˆê°<br>2. ë¶ˆí•„ìš”í•œ ê²€ì‚¬ ë°°ì œ<br>3. ê²€ì‚¬ ì§í›„ 1ë¶„ ë‚´ ìë£Œì „ì†¡ ì‹œìŠ¤í…œ<br><br>ê±°í’ˆì„ ëº€ ì‹¤ì† ìˆëŠ” ê°€ê²©ì…ë‹ˆë‹¤!' },
            defect: { q: 'ì¤‘ëŒ€í•˜ìê°€ ë­”ê°€ìš”?', a: 'ğŸ› ï¸ <b>ì¤‘ëŒ€í•˜ì ì§‘ì¤‘ ì ê²€</b><br>ì œì‘ë¶ˆëŸ‰, ì‹œê³µë¶ˆëŸ‰, ê²°ë¡œ, ì™¸í’ì„ ì¤‘ì  ê²€ì‚¬í•©ë‹ˆë‹¤.<br>ì˜¤ì—¼Â·í ì§‘ë³´ë‹¤ ì¤‘ëŒ€ í•˜ìë¥¼ ì§‘ì¤‘ì ìœ¼ë¡œ ì°¾ì•„ëƒ…ë‹ˆë‹¤!' },
            booking: { q: 'ì˜ˆì•½ì€ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?', a: 'ğŸ“… <b>ì˜ˆì•½ ë°©ë²•</b><br>1. í•˜ë‹¨ ìœ ë£Œì˜ˆì•½ ë²„íŠ¼ í´ë¦­<br>2. ì‹ ì²­ì„œ ì‘ì„± ë° ì…ê¸ˆ<br>3. 010-2322-0949ë¡œ ì…ê¸ˆìëª…/ë‚ ì§œ ë¬¸ì<br><br>í™•ì¸ í›„ í™•ì • ë¬¸ìë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤!' }
        };

        App.askBot = (type) => {
            const body = document.getElementById('chatBody');
            const { q, a } = botAnswers[type];
            body.innerHTML += `<div class="bubble user">${q}</div>`;
            setTimeout(() => {
                body.innerHTML += `<div class="bubble bot">${a}</div>`;
                body.scrollTop = body.scrollHeight;
            }, 300);
        };
    </script>
</body>
</html>




